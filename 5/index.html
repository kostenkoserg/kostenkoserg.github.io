<<!DOCTYPE html>
<html lang="en">
  <head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132824591-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-132824591-1');
</script>

    <meta charset="utf-8"/>
    <title>Sergii Kostenko's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <!--link href="../css/prettify.css" rel="stylesheet"-->
    <link href="../css/prism.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <b><a class="navbar-brand" href="../index.html">Sergii Kostenko's Blog</a></b>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../about.html">About</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
              <ul class="dropdown-menu">
										<li><a href="../tags/wildfly.html">wildfly</a></li>
										<li><a href="../tags/logging.html">logging</a></li>
										<li><a href="../tags/jakartaee.html">jakartaee</a></li>
										<li><a href="../tags/resin.html">resin</a></li>
										<li><a href="../tags/performance.html">performance</a></li>
										<li><a href="../tags/infinispan.html">infinispan</a></li>
										<li><a href="../tags/gradle.html">gradle</a></li>
										<li><a href="../tags/ide.html">ide</a></li>
										<li><a href="../tags/cdi.html">cdi</a></li>
										<li><a href="../tags/batch.html">batch</a></li>
										<li><a href="../tags/ci.html">ci</a></li>
										<li><a href="../tags/openapi.html">openapi</a></li>
										<li><a href="../tags/microprofile.html">microprofile</a></li>
										<li><a href="../tags/jberet.html">jberet</a></li>
										<li><a href="../tags/github.html">github</a></li>
										<li><a href="../tags/activemq.html">activemq</a></li>
										<li><a href="../tags/jetty.html">jetty</a></li>
										<li><a href="../tags/api.html">api</a></li>
										<li><a href="../tags/jpa.html">jpa</a></li>
										<li><a href="../tags/jenkins.html">jenkins</a></li>
										<li><a href="../tags/json-b.html">json-b</a></li>
										<li><a href="../tags/linux.html">linux</a></li>
										<li><a href="../tags/jmx.html">jmx</a></li>
										<li><a href="../tags/vaadin.html">vaadin</a></li>
										<li><a href="../tags/java.html">java</a></li>
										<li><a href="../tags/security.html">security</a></li>
										<li><a href="../tags/jms.html">jms</a></li>
										<li><a href="../tags/jaxb.html">jaxb</a></li>
										<li><a href="../tags/sql.html">sql</a></li>
										<li><a href="../tags/swagger.html">swagger</a></li>
										<li><a href="../tags/hibernate.html">hibernate</a></li>
										<li><a href="../tags/quarkus.html">quarkus</a></li>
										<li><a href="../tags/jwt.html">jwt</a></li>
										<li><a href="../tags/rest-client.html">rest-client</a></li>
										<li><a href="../tags/jax-rs.html">jax-rs</a></li>
										<li><a href="../tags/jsr532.html">jsr532</a></li>
										<li><a href="../tags/jbake.html">jbake</a></li>
								</ul>
						</li>
          </ul>
					<!-- switch language -->
					<ul class="nav navbar-nav navbar-right">
						<li><a href="/">en</a></li>
						<li><a href="/ru">ru</a></li>
						<li><a  class="icon-rss" href="../feed.xml"></a></li>
					</ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">


				<a href="https://kostenko.org/blog/2019/08/wildfly-jconsole-mbeans-list-problem.html"><h1>Wildfly JMX connection problems (so slow and terminates)</h1></a>
				<p>19 August 2019</p>
  			<p><p>JMX (Java Management Extensions ) - is a technology that provide us possibility to monitoring applications (application servers) by <strong>MBeans (Managed Bean)</strong> objects.<br />
List of supported MBeans can be obtained by <strong>JConsole</strong> tool that already included to JDK. As JMX does not provide strong defined communication protocol, - implementations can be different depends on vendor.<br />
For example, to connect to Wildfly Application Server you need to use included in distribution <code>jconsole.sh</code> script:</p>
<pre><code class="language-java">&lt;WFLY_HOME&gt;/bin/jconsole.sh
</code></pre>
<p>or add <code>&lt;WFLY_HOME&gt;/bin/client/jboss-client.jar</code> to classpath:</p>
<pre><code class="language-java">jconsole J-Djava.class.path=$JAVA_HOME\lib\tools.jar;$JAVA_HOME\lib\jconsole.jar;jboss-client.jar
</code></pre>
<p>By default, Wildfly uses <code>timeout = 60s</code> for <strong>remote JMX connections</strong>, after that connection will terminated:<br />
<img src="/img/2019-08-jmx-jconsole.png" alt="jconsole terminated connection" /><br />
To change default timeout value, use <code>org.jboss.remoting-jmx.timeout</code> property:</p>
<pre><code class="language-java">./jconsole.sh -J-Dorg.jboss.remoting-jmx.timeout=300
</code></pre>
<p>But increasing timeouts, is not always good solution. So, lets search for the reason of slowness. To construct list of MBeans, jconsole recursively requests ALL MBeans, that can be extremely slow in case many deployments and many loggers. (Reported issue: <a href="https://issues.jboss.org/browse/WFCORE-3186">WFCORE-3186</a>). Partial solution here is reducing count of log files by changing rotating type from <code>periodic-size-rotating-file-handler</code>  to <code>size-rotating-file-handler</code>.</p>
<p>Other reason of extremely slowness can be <code>Batch subsystem (JBeret)</code>. Last one stores a lot of working information in their tables (in memory or on remote DB, depends on configuration). If this tables big enough - it can negative affect performance of server. So, if you, no need for this data then just cleanup this stuff periodically. (for example, every redeploy in case you do it often enough):</p>
<pre><code class="language-java">TRUNCATE TABLE PARTITION_EXECUTION CASCADE;
TRUNCATE TABLE STEP_EXECUTION CASCADE;
TRUNCATE TABLE JOB_EXECUTION CASCADE;
TRUNCATE TABLE JOB_INSTANCE CASCADE;  
</code></pre>
<p>From other point of view, obtaining ALL MBeans is not good decision as well. So, just use tooling that allows to find MBeans by path.</p>
</p>
				<p class="text-right"><a href="https://kostenko.org/blog/2019/08/wildfly-jconsole-mbeans-list-problem.html#disqus_thread" data-disqus-identifier="blog/2019/08/wildfly-jconsole-mbeans-list-problem.html">Comments</a></p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/08/ee-application-multi-module-template.html"><h1>Jakarta EE application multi module gradle template</h1></a>
				<p>08 August 2019</p>
  			<p><p>In this post i will share simple and useful <strong>gradle</strong> template to organize multi module Jakarta EE application. We will implement typical one which consists from REST controller (<strong>module1</strong>) and some main logic (<strong>module2</strong>). Big picture of our application architecture is:</p>
<p><img src="/img/2019-08-ee-multimodule-template-arch.png" alt="EE multi module application" /></p>
<p>So, lets do initialization of project with next  gradle template:<br />
<code>settings.gradle:</code></p>
<pre><code class="language-java">rootProject.name = 'ee-application-multi-module-gradle-template'
include 'module1'
include 'module2:module2-api', 'module2:module2-core'
</code></pre>
<p><code>root build.gradle:</code></p>
<pre><code class="language-java">defaultTasks 'clean', 'build'
subprojects {
    ext.libraryVersions = [
        javaee                  : '8.0',
    ]
    defaultTasks 'clean', 'build'
    repositories {
        jcenter()
    }
}
</code></pre>
<p>Above, we described initial application structure, where <strong>module1</strong> is flat sub project for our controller and <strong>module2</strong> is our main logic which consists from <code>API</code> and <code>Core</code> sub projects. As controller will use main logic API and we decided to separate application to modules (that means no big enterprise archive) - our sub projects should be simple enough:</p>
<p><code>module1 build.gradle:</code></p>
<pre><code class="language-java">apply plugin: 'war'
dependencies {
    compile project(':module2:module2-api')
    providedCompile &quot;javax:javaee-api:${libraryVersions.javaee}&quot;
}
</code></pre>
<p><code>module2:module2-api:</code></p>
<pre><code class="language-java">apply plugin: 'java'
dependencies {
}
</code></pre>
<p><code>module2:module2-core:</code></p>
<pre><code class="language-java">apply plugin: 'war'
dependencies {
    compile project(':module2:module2-api')
    providedCompile &quot;javax:javaee-api:${libraryVersions.javaee}&quot;
}
</code></pre>
<p>Actually, that's it!<br />
Now we can implement our controller like:</p>
<pre><code class="language-java">@Path(&quot;/&quot;)
@Stateless
@Consumes(MediaType.APPLICATION_JSON)
@Produces(MediaType.APPLICATION_JSON)
public class TestEndpoint {

    @EJB(lookup = TestService.TEST_SERVICE_JNDI)
    TestService testService;

    @GET
    @Path(&quot;/test&quot;)
    public Response test() {
        SomethingDto something = testService.doSomething();
        return Response.ok().entity(something.getMessage()).build();
    }
</code></pre>
<p>In turn, main logic <code>API</code> contents from <code>Interface</code> and <code>DTO</code>:<br />
<code>TestService.java:</code></p>
<pre><code class="language-java">public interface TestService {

  String TEST_SERVICE_NAME = &quot;test-service&quot;;
  String TEST_SERVICE_JNDI =&quot;java:global/module2-core/&quot; + TEST_SERVICE_NAME;

  SomethingDto doSomething();
}
</code></pre>
<p><code>SomethingDto.java:</code></p>
<pre><code class="language-java">public class SomethingDto implements Serializable{
  ...
}
</code></pre>
<p>In the end, main logic <code>Core</code> contents from the logic that implements API:<br />
<code>TestServiceImpl.java</code></p>
<pre><code class="language-java">@Remote(TestService.class)
@Stateless(name = TestService.TEST_SERVICE_NAME)
public class TestServiceImpl implements TestService {

    @PersistenceContext
    EntityManager entityManager;

    @Override
    public SomethingDto doSomething() {
        TestEntity entity = entityManager.find(TestEntity.class, Long.MAX_VALUE);
        return new SomethingDto(&quot;Hello Jakarta EE world!&quot;);
    }
}
</code></pre>
<p>Described Jakarta EE application architecture allows us enjoy all power of EE with absolutely transparent inter module interactions and, the same time, stay close to micro service design - as we have no limits with using one container for all modules.</p>
<p>Source code of this demo available on <a href="https://github.com/kostenkoserg/ee-application-multi-module-gradle-template">GitHub</a></p>
</p>
				<p class="text-right"><a href="https://kostenko.org/blog/2019/08/ee-application-multi-module-template.html#disqus_thread" data-disqus-identifier="blog/2019/08/ee-application-multi-module-template.html">Comments</a></p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/08/java-catch-os-signals.html"><h1>How to catch &apos;kill&apos; signals in java</h1></a>
				<p>07 August 2019</p>
  			<p><p>You can send different signals to your application using <strong>kill -l</strong> command. By default <strong>kill</strong> will sent <code>TERM</code> signal. Java by default catches some types of signals, for example</p>
<pre><code class="language-java">kill -3 &lt;PID&gt;
</code></pre>
<p>will dump Java stack traces to the standard error stream.</p>
<p>Also, you can catch <code>signal</code> inside your application, like</p>
<pre><code class="language-java">public class App {
    public static void main(String... s) throws Exception {

        Signal.handle(new Signal(&quot;HUP&quot;), signal -&gt; {
            System.out.println(signal.getName() + &quot; (&quot; + signal.getNumber() + &quot;)&quot;);
        });

        new Thread(new Runnable() {
            @Override
            public void run() {
                while (true) {
                    try {
                        Thread.sleep(1000l);
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }
            }
        }).start();
    }
}
</code></pre>
<p>List of available signals you can get by executing <code>kill -l</code>:</p>
<pre><code class="language-java">kostenko@kostenko:~$ kill -l
 1) SIGHUP	 2) SIGINT	 3) SIGQUIT	 4) SIGILL	 5) SIGTRAP
 6) SIGABRT	 7) SIGBUS	 8) SIGFPE	 9) SIGKILL	10) SIGUSR1
11) SIGSEGV	12) SIGUSR2	13) SIGPIPE	14) SIGALRM	15) SIGTERM
16) SIGSTKFLT	17) SIGCHLD	18) SIGCONT	19) SIGSTOP	20) SIGTSTP
21) SIGTTIN	22) SIGTTOU	23) SIGURG	24) SIGXCPU	25) SIGXFSZ
26) SIGVTALRM	27) SIGPROF	28) SIGWINCH	29) SIGIO	30) SIGPWR
31) SIGSYS	34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3
38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8
43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13
48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12
53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7
58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2
63) SIGRTMAX-1	64) SIGRTMAX
</code></pre>
<p>Notice! Not all signals can be catched in application, some of them reserved by OS. For example, if you will try to handle <strong>kill -SIGKILL (kill -9)</strong> , then you get:</p>
<pre><code class="language-java">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Signal already used by VM or OS: SIGKILL
	at java.base/jdk.internal.misc.Signal.handle(Signal.java:173)
	at jdk.unsupported/sun.misc.Signal.handle(Signal.java:157)
</code></pre>
</p>
				<p class="text-right"><a href="https://kostenko.org/blog/2019/08/java-catch-os-signals.html#disqus_thread" data-disqus-identifier="blog/2019/08/java-catch-os-signals.html">Comments</a></p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/08/wildfly-load-balancing-metrics.html"><h1>Wildfly. Configure load balancing metrics</h1></a>
				<p>06 August 2019</p>
  			<p><p>Previously i wrote about <a href="https://kostenko.org/blog/2019/04/wildfly-cluster-domain-mode.html">Wildfly domain mode cluster and load balancing from the box</a>. But what if we would like to do balancing depends on specific server behavior ?</p>
<p>Wildfly subsystem <code>mod_cluster</code> provide us several predefined metric types to determine best request balancing:</p>
<ul>
<li><strong>cpu</strong>: based on CPU load</li>
<li><strong>mem</strong>: based on system memory usage</li>
<li><strong>heap</strong>: based on heap usage</li>
<li><strong>sessions</strong>: based on number of web sessions</li>
<li><strong>requests</strong>: based on amount of requests/sec</li>
<li><strong>send-traffic</strong>: based on outgoing requests traffic</li>
<li><strong>receive-traffic</strong>: based on incoming requests POST traffic</li>
<li><strong>busyness</strong>: computes based on amount of Thread from Thread Pool usage that are busy servicing requests</li>
</ul>
<p>As well you also can configure <strong>weight</strong> (impact of a metric respect to other metrics) and <strong>capacity</strong> properties;<br />
Below is example, how to change default based on CPU balancing to balancing based on busyness + CPU:</p>
<pre><code class="language-java">/subsystem=modcluster/mod-cluster-config=configuration/dynamic-load-provider=configuration/load-metric=cpu:remove()
/subsystem=modcluster/mod-cluster-config=configuration:add-metric(type=busyness,weight=2)
/subsystem=modcluster/mod-cluster-config=configuration:add-metric(type=cpu,weight=1)
</code></pre>
<p>If predefined types is not enough, - you can provide <code>custom-load-metric</code> by implementing <code>org.jboss.modcluster.load.metric.impl.AbstractLoadMetric</code>. To possibility of using your custom metric,- you need to copy packaged JAR to <code>modcluster</code> module and update <code>module.xml</code>. Now you can use your custom metric with your configuration like</p>
<pre><code class="language-java"> &lt;custom-load-metric class=&quot;org.kostenko.examples.wldfly.modcluster.MyBalancingMetric&quot;&gt;  
</code></pre>
</p>
				<p class="text-right"><a href="https://kostenko.org/blog/2019/08/wildfly-load-balancing-metrics.html#disqus_thread" data-disqus-identifier="blog/2019/08/wildfly-load-balancing-metrics.html">Comments</a></p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/08/embedded-jetty-server-cut-responses.html"><h1>Embedded Jetty server truncates responses</h1></a>
				<p>06 August 2019</p>
  			<p><p>Jetty server has lot of configuration options. One of them is <code>OutputBufferSize</code></p>
<pre><code class="language-java">HttpConfiguration httpConfig = new HttpConfiguration();
httpConfig.setOutputBufferSize(1024);
</code></pre>
<p>If this property set to value less than your respopnse - jetty just will truncate last one.</p>
</p>
				<p class="text-right"><a href="https://kostenko.org/blog/2019/08/embedded-jetty-server-cut-responses.html#disqus_thread" data-disqus-identifier="blog/2019/08/embedded-jetty-server-cut-responses.html">Comments</a></p>
				<hr/>

		<ul class="pager">
				<li class="previous"><a href="https://kostenko.org/4">Previous</a></li>
			<li">Page: 5/10 (<a href="../archive.html">archive</a>)</li>
				<li class="next"><a href="https://kostenko.org/6">Next</a></li>
		</ul>
		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2019 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.6.4</a></p>
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery-1.11.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <!--script src="../js/prettify.js"></script-->
		<script src="../js/prism.js"></script>

		<script id="dsq-count-scr" src="//kostenko-org.disqus.com/count.js" async></script>
  </body>
</html>
