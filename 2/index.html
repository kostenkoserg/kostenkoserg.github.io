<<!DOCTYPE html>
<html lang="en">
  <head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132824591-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-132824591-1');
</script>

    <meta charset="utf-8"/>
    <title>Sergii Kostenko's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <!--link href="../css/prettify.css" rel="stylesheet"-->
    <link href="../css/prism.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <b><a class="navbar-brand" href="../index.html">Sergii Kostenko's Blog</a></b>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../about.html">About</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
              <ul class="dropdown-menu">
										<li><a href="../tags/wildfly.html">wildfly</a></li>
										<li><a href="../tags/logging.html">logging</a></li>
										<li><a href="../tags/jakartaee.html">jakartaee</a></li>
										<li><a href="../tags/performance.html">performance</a></li>
										<li><a href="../tags/infinispan.html">infinispan</a></li>
										<li><a href="../tags/gradle.html">gradle</a></li>
										<li><a href="../tags/ide.html">ide</a></li>
										<li><a href="../tags/cdi.html">cdi</a></li>
										<li><a href="../tags/batch.html">batch</a></li>
										<li><a href="../tags/ci.html">ci</a></li>
										<li><a href="../tags/openapi.html">openapi</a></li>
										<li><a href="../tags/microprofile.html">microprofile</a></li>
										<li><a href="../tags/jberet.html">jberet</a></li>
										<li><a href="../tags/github.html">github</a></li>
										<li><a href="../tags/activemq.html">activemq</a></li>
										<li><a href="../tags/jetty.html">jetty</a></li>
										<li><a href="../tags/api.html">api</a></li>
										<li><a href="../tags/jpa.html">jpa</a></li>
										<li><a href="../tags/jenkins.html">jenkins</a></li>
										<li><a href="../tags/linux.html">linux</a></li>
										<li><a href="../tags/jmx.html">jmx</a></li>
										<li><a href="../tags/vaadin.html">vaadin</a></li>
										<li><a href="../tags/java.html">java</a></li>
										<li><a href="../tags/security.html">security</a></li>
										<li><a href="../tags/jms.html">jms</a></li>
										<li><a href="../tags/sql.html">sql</a></li>
										<li><a href="../tags/swagger.html">swagger</a></li>
										<li><a href="../tags/hibernate.html">hibernate</a></li>
										<li><a href="../tags/quarkus.html">quarkus</a></li>
										<li><a href="../tags/jwt.html">jwt</a></li>
										<li><a href="../tags/rest-client.html">rest-client</a></li>
										<li><a href="../tags/jax-rs.html">jax-rs</a></li>
										<li><a href="../tags/jsr532.html">jsr532</a></li>
										<li><a href="../tags/jbake.html">jbake</a></li>
								</ul>
						</li>
          </ul>
					<!-- switch language -->
					<ul class="nav navbar-nav navbar-right">
						<li><a href="/">en</a></li>
						<li><a href="/ru">ru</a></li>
						<li><a  class="icon-rss" href="../feed.xml"></a></li>
					</ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">


				<a href="https://kostenko.org/blog/2020/02/jpa-relation-mappings.html"><h1>Simple note about using JPA relation  mappings</h1></a>
				<p>14 February 2020</p>
  			<p><p>There is a lot of typical examples how to build JPA <code>@OneToMany</code> and <code>@ManyToOne</code> relationships in your Jakarta EE application. And usually it looks like:</p>
<pre><code class="language-java">@Entity
@Table(name = &quot;author&quot;)
public class Author {
    @OneToMany
    private List&lt;Book&gt; book;
    ...
}
</code></pre>
<pre><code class="language-java">@Entity
@Table(name = &quot;book&quot;)
public class Book {
    @ManyToOne
    private Author author;
    ...
}
</code></pre>
<p>This code looks pretty clear, but on my opinion <strong>you should NOT USE this style</strong> in your real world application. From years of JPA using experience i definitely can say that sooner or later your project will stuck with known performance issues and holy war questions about: <strong>N+1</strong>, <strong>LazyInitializationException</strong>, <strong>Unidirectional @OneToMany</strong> , <strong>CascadeTypes</strong> ,<strong>LAZY vs EAGER</strong>, <strong>JOIN FETCH</strong>, <strong>Entity Graph</strong>, <strong>Fetching lot of unneeded data</strong>, <strong>Extra queries (for example: select Author by id before persist Book)</strong> etcetera.  Even if you are have answers for each potential issue above, usually proposed solution will add unreasonable complexity to the project.</p>
<p>To avoid potential issues i recommend to follow next rules:</p>
<ul>
<li>Avoid using of <code>@OneToMany</code> at all</li>
<li>Use <code>@ManyToOne</code> to build constrains but work with  <strong>ID</strong> instead of Entity</li>
</ul>
<p>Unfortunately, simple snippet below does not work as expected in case <code>persist</code></p>
<pre><code class="language-java">@ManyToOne(targetEntity = Author.class)
private long authorId;
</code></pre>
<p>But,we can use next one instead of</p>
<pre><code class="language-java">@JoinColumn(name = &quot;authorId&quot;, insertable = false, updatable = false)
@ManyToOne(targetEntity = Author.class)
private Author author;

private long authorId;

public long getAuthorId() {
    return authorId;
}

public void setAuthorId(long authorId) {
    this.authorId = authorId;
}
</code></pre>
<p>Hope, this two simple rules helps you enjoy all power of JPA with KISS and decreasing count of complexity.</p>
</p>
				<p class="text-right"><a href="https://kostenko.org/blog/2020/02/jpa-relation-mappings.html#disqus_thread" data-disqus-identifier="blog/2020/02/jpa-relation-mappings.html">Comments</a></p>
				<hr/>
				<a href="https://kostenko.org/blog/2020/01/infinispan-distributed-cache-issues.html"><h1>ISPN000299: Unable to acquire lock after 15 seconds for key</h1></a>
				<p>05 February 2020</p>
  			<p><p>Distributed cache is a wide used technology that provides useful possibilities to share state whenever it necessary. Wildfly supports distributed cache through <a href="https://infinispan.org/">infinispan</a> subsystem and actually it works well, but in case height load and concurrent data access you may run into a some issues like:</p>
<ul>
<li>ISPN000299: Unable to acquire lock after 15 seconds for key</li>
<li>ISPN000924: beforeCompletion() failed for SynchronizationAdapter</li>
<li>ISPN000160: Could not complete injected transaction.</li>
<li>ISPN000136: Error executing command PrepareCommand on Cache</li>
<li>ISPN000476: Timed out waiting for responses for request</li>
<li>ISPN000482: Cannot create remote transaction GlobalTx</li>
</ul>
<p>and others.</p>
<p>In my case i had two node cluster with next infinispan configuration:</p>
<pre><code class="language-java">/profile=full-ha/subsystem=infinispan/cache-container=myCache/distributed-cache=userdata:add()
/profile=full-ha/subsystem=infinispan/cache-container=myCache/distributed-cache=userdata/component=transaction:add(mode=BATCH)
</code></pre>
<p><strong>distributed</strong> cache above means that number of copies are maintained, however this is typically less than the number of nodes in the cluster. From other point of view, to provide redundancy and fault tolerance you should configure enough amount of <strong>owners</strong> and obviously <strong>2</strong> is the necessary minimum here. So, in case usage small cluster and keep in mind the <a href="https://issues.redhat.com/browse/JDG-1318">BUG</a>, - i recommend use <strong>replicated-cache</strong> (all nodes in a cluster hold all keys)</p>
<p>Please, compare <a href="https://infinispan.org/docs/dev/titles/clustering/clustering.html#which_cache_mode_should_i_use">Which cache mode should I use?</a> with your needs.</p>
<p>Solution:</p>
<pre><code class="language-java">/profile=full-ha/subsystem=infinispan/cache-container=myCache/distributed-cache=userdata:remove()
/profile=full-ha/subsystem=infinispan/cache-container=myCache/replicated-cache=userdata:add()
/profile=full-ha/subsystem=infinispan/cache-container=myCache/replicated-cache=userdata/component=transaction:add(mode=NON_DURABLE_XA, locking=OPTIMISTIC)
</code></pre>
<p>Note!, <code>NON_DURABLE_XA</code> doesn't keep any transaction recovery information and if you still getting <code>Unable to acquire lock</code> errors on application critical data - you can try to resolve it by some <strong>retry</strong> policy and <strong>fail-fast</strong> transaction:</p>
<pre><code class="language-java">/profile=full-ha/subsystem=infinispan/cache-container=myCache/distributed-cache=userdata/component=locking:write-attribute(name=acquire-timeout, value=0)
</code></pre>
</p>
				<p class="text-right"><a href="https://kostenko.org/blog/2020/01/infinispan-distributed-cache-issues.html#disqus_thread" data-disqus-identifier="blog/2020/01/infinispan-distributed-cache-issues.html">Comments</a></p>
				<hr/>
				<a href="https://kostenko.org/blog/2020/01/sql-spying-with-wildfly.html"><h1>Logging for JPA SQL queries with Wildfly</h1></a>
				<p>10 January 2020</p>
  			<p><p>Logging for real SQL queries is very important in case using any ORM solution, - as you never can be sure <strong>which</strong> and <strong>how many</strong> requests will send JPA provider to do <code>find</code>, <code>merge</code>, <code>query</code> or some other operation.</p>
<p>Wildfly uses Hibernate as JPA provider and provides few standard ways to enable SQL logging:</p>
<p><strong>1.</strong> Add <code>hibernate.show_sql</code> property to your <strong>persistence.xml</strong> :</p>
<pre><code class="language-java">&lt;properties&gt;
    ...
    &lt;property name=&quot;hibernate.show_sql&quot; value=&quot;true&quot; /&gt;
    ...
&lt;/properties&gt;
</code></pre>
<pre><code class="language-java">INFO  [stdout] (default task-1) Hibernate: insert into blogentity (id, body, title) values (null, ?, ?)
INFO  [stdout] (default task-1) Hibernate: select blogentity0_.id as id1_0_, blogentity0_.body as body2_0_, blogentity0_.title as title3_0_ from blogentity blogentity0_ where blogentity0_.title=?
</code></pre>
<p><strong>2.</strong> Enable <code>ALL</code> log level for <code>org.hibernate</code> category like:</p>
<pre><code class="language-java">/subsystem=logging/periodic-rotating-file-handler=sql_handler:add(level=ALL, file={&quot;path&quot;=&gt;&quot;sql.log&quot;}, append=true, autoflush=true, suffix=.yyyy-MM-dd,formatter=&quot;%d{yyyy-MM-dd HH:mm:ss,SSS}&quot;)
/subsystem=logging/logger=org.hibernate.SQL:add(use-parent-handlers=false,handlers=[&quot;sql_handler&quot;])
/subsystem=logging/logger=org.hibernate.type.descriptor.sql.BasicBinder:add(use-parent-handlers=false,handlers=[&quot;sql_handler&quot;])
</code></pre>
<pre><code class="language-java">DEBUG [o.h.SQL] insert into blogentity (id, body, title) values (null, ?, ?)
TRACE [o.h.t.d.s.BasicBinder] binding parameter [1] as [VARCHAR] - [this is body]
TRACE [o.h.t.d.s.BasicBinder] binding parameter [2] as [VARCHAR] - [title]
DEBUG [o.h.SQL] select blogentity0_.id as id1_0_, blogentity0_.body as body2_0_, blogentity0_.title as title3_0_ from blogentity blogentity0_ where blogentity0_.title=?
TRACE [o.h.t.d.s.BasicBinder] binding parameter [1] as [VARCHAR] - [title]
</code></pre>
<p><strong>3.</strong> Enable spying of SQL statements:</p>
<pre><code class="language-java">/subsystem=datasources/data-source=ExampleDS/:write-attribute(name=spy,value=true)
/subsystem=logging/logger=jboss.jdbc.spy/:add(level=DEBUG)
</code></pre>
<pre><code class="language-java">DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [DataSource] getConnection()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [Connection] prepareStatement(insert into blogentity (id, body, title) values (null, ?, ?), 1)
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [PreparedStatement] setString(1, this is body)
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [PreparedStatement] setString(2, title)
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [PreparedStatement] executeUpdate()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [PreparedStatement] getGeneratedKeys()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] next()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] getMetaData()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] getLong(1)
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] close()
...
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [DataSource] getConnection()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [Connection] prepareStatement(select blogentity0_.id as id1_0_, blogentity0_.body as body2_0_, blogentity0_.title as title3_0_ from blogentity blogentity0_ where blogentity0_.title=?)
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [PreparedStatement] setString(1, title)
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [PreparedStatement] executeQuery()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] next()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] getLong(id1_0_)
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] wasNull()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] getString(body2_0_)
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] wasNull()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] getString(title3_0_)
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] wasNull()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] next()
DEBUG [j.j.spy] java:jboss/datasources/ExampleDS [ResultSet] close()
</code></pre>
<p>So, from above we can see that variants <strong>2</strong> and <strong>3</strong> is most useful as allows to log queries with parameters. From other point of view - SQL logging can generate lot of unneeded debug information on production. To avoid garbage data in your log files, feel free to use <strong><a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/6.4/html/administration_and_configuration_guide/chap-the_logging_subsystem#Filter_Expressions_for_Logging">Filter Expressions for Logging</a></strong></p>
</p>
				<p class="text-right"><a href="https://kostenko.org/blog/2020/01/sql-spying-with-wildfly.html#disqus_thread" data-disqus-identifier="blog/2020/01/sql-spying-with-wildfly.html">Comments</a></p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/12/jakarta-ee-asvs-security.html"><h1>Why Jakarta EE beats other java solutions from security point of view</h1></a>
				<p>27 December 2019</p>
  			<p><p>No one care about security until security incident. In case enterprise development last one can costs too much, so any preventive steps can help.  Significant part part of the OWASP Application Security Verification Standard (<strong>ASVS</strong>) reads:</p>
<blockquote>
<p><strong>10.2.1</strong> Verify that the application source code and third party libraries do not contain unauthorized phone home or data collection capabilities. Where such functionality exists, obtain the user's permission for it to operate before collecting any data.<br />
<strong>10.2.3</strong> Verify that the application source code and third party libraries do not contain back doors, such as hard-coded or additional undocumented accounts or keys, code obfuscation, undocumented binary blobs, rootkits, or anti-debugging, insecure debugging features, or otherwise out of date, insecure, or hidden functionality that could be used maliciously if discovered.<br />
<strong>10.2.4</strong> Verify that the application source code and third party libraries does not contain time bombs by searching for date and time related functions.<br />
<strong>10.2.5</strong> Verify that the application source code and third party libraries does not contain malicious code, such as salami attacks, logic bypasses, or logic bombs.<br />
<strong>10.2.6</strong> Verify that the application source code and third party libraries do not contain Easter eggs or any other potentially unwanted functionality.<br />
<strong>10.3.2</strong> Verify that the application employs integrity protections, such as code signing or sub-resource integrity. The application must not load or execute code from untrusted sources, such as loading includes, modules, plugins, code, or libraries from untrusted sources or the Internet.<br />
<strong>14.2.4</strong> Verify that third party components come from pre-defined, trusted and continually maintained repositories.</p>
</blockquote>
<p>In other words that meaning you should: <strong>&quot;Verify all code including third-party binaries, libraries, frameworks are reviewed for hardcoded credentials (backdoors).&quot;</strong></p>
<p>In case development according to Jakarta EE specification you shouldn't be able to use poor controlled  third party libraries, as all you need already came with Application Server. In turn, last one is responsible for in time security  updates, ussage of verified libraries and many more...</p>
</p>
				<p class="text-right"><a href="https://kostenko.org/blog/2019/12/jakarta-ee-asvs-security.html#disqus_thread" data-disqus-identifier="blog/2019/12/jakarta-ee-asvs-security.html">Comments</a></p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/12/setup-darcula-laf-netbeans-11.html"><h1>How to setup Darcula LAF on Netbeans 11</h1></a>
				<p>26 December 2019</p>
  			<p><p>It is pity, but Apache Netbeans IDE still comes without support default <strong>dark</strong> mode. Enabling <code>Netbeans 8.2 Plugin portal</code> does not have any effect, so to use plugins from previous versions we need to add <code>New Provider</code> (Tools-&gt;Plugins) with next URL:</p>
<pre><code class="language-java">http://plugins.netbeans.org/nbpluginportal/updates/8.2/catalog.xml.gz
</code></pre>
<p><img src="/img/2019-12-new-provider.png" alt="add provider" /></p>
<p>After that you should be able setup Darcula LAF in standard way</p>
<p><img src="/img/2019-12-select-laf.png" alt="add provider" /></p>
</p>
				<p class="text-right"><a href="https://kostenko.org/blog/2019/12/setup-darcula-laf-netbeans-11.html#disqus_thread" data-disqus-identifier="blog/2019/12/setup-darcula-laf-netbeans-11.html">Comments</a></p>
				<hr/>

		<ul class="pager">
				<li class="previous"><a href="https://kostenko.org/">Previous</a></li>
			<li">Page: 2/9 (<a href="../archive.html">archive</a>)</li>
				<li class="next"><a href="https://kostenko.org/3">Next</a></li>
		</ul>
		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2019 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.6.3</a></p>
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery-1.11.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <!--script src="../js/prettify.js"></script-->
		<script src="../js/prism.js"></script>

		<script id="dsq-count-scr" src="//kostenko-org.disqus.com/count.js" async></script>
  </body>
</html>
