<<!DOCTYPE html>
<html lang="en">
  <head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132824591-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-132824591-1');
</script>

    <meta charset="utf-8"/>
    <title>Sergii Kostenko's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <!--link href="../css/prettify.css" rel="stylesheet"-->
    <link href="../css/prism.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <b><a class="navbar-brand" href="../index.html">Sergii Kostenko's Blog</a></b>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../about.html">About</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
              <ul class="dropdown-menu">
										<li><a href="../tags/Jetty.html">Jetty</a></li>
										<li><a href="../tags/Performance.html">Performance</a></li>
										<li><a href="../tags/Gradle.html">Gradle</a></li>
										<li><a href="../tags/API.html">API</a></li>
										<li><a href="../tags/JPA.html">JPA</a></li>
										<li><a href="../tags/JMX.html">JMX</a></li>
										<li><a href="../tags/Jakarta EE.html">Jakarta EE</a></li>
										<li><a href="../tags/Linux.html">Linux</a></li>
										<li><a href="../tags/JBake.html">JBake</a></li>
										<li><a href="../tags/JMS.html">JMS</a></li>
										<li><a href="../tags/Jenkins.html">Jenkins</a></li>
										<li><a href="../tags/SQL.html">SQL</a></li>
										<li><a href="../tags/JAX-RS.html">JAX-RS</a></li>
										<li><a href="../tags/CDI.html">CDI</a></li>
										<li><a href="../tags/GitHub.html">GitHub</a></li>
										<li><a href="../tags/CI.html">CI</a></li>
										<li><a href="../tags/JakartaEE.html">JakartaEE</a></li>
										<li><a href="../tags/Hibernate.html">Hibernate</a></li>
										<li><a href="../tags/WildFly.html">WildFly</a></li>
										<li><a href="../tags/Wildfly.html">Wildfly</a></li>
										<li><a href="../tags/Java.html">Java</a></li>
										<li><a href="../tags/Java EE.html">Java EE</a></li>
								</ul>
						</li>
          </ul>
					<!-- switch language -->
					<ul class="nav navbar-nav navbar-right">
						<li><a href="/">en</a></li>
						<li><a href="/ru">ru</a></li>
						<li><a  class="icon-rss" href="../feed.xml"></a></li>
					</ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">


				<a href="https://kostenko.org/blog/2019/08/java-catch-os-signals.html"><h1>How to catch &apos;kill&apos; signals in java</h1></a>
				<p>07 August 2019</p>
  			<p><p>You can send different signals to your application using <strong>kill -l</strong> command. By default <strong>kill</strong> will sent <code>TERM</code> signal. Java by default catches some types of signals, for example</p>
<pre><code class="language-java">kill -3 &lt;PID&gt;
</code></pre>
<p>will dump Java stack traces to the standard error stream.</p>
<p>Also, you can catch <code>signal</code> inside your application, like</p>
<pre><code class="language-java">public class App {
    public static void main(String... s) throws Exception {

        Signal.handle(new Signal(&quot;HUP&quot;), signal -&gt; {
            System.out.println(signal.getName() + &quot; (&quot; + signal.getNumber() + &quot;)&quot;);
        });

        new Thread(new Runnable() {
            @Override
            public void run() {
                while (true) {
                    try {
                        Thread.sleep(1000l);
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }
            }
        }).start();
    }
}
</code></pre>
<p>List of available signals you can get by executing <code>kill -l</code>:</p>
<pre><code class="language-java">kostenko@kostenko:~$ kill -l
 1) SIGHUP	 2) SIGINT	 3) SIGQUIT	 4) SIGILL	 5) SIGTRAP
 6) SIGABRT	 7) SIGBUS	 8) SIGFPE	 9) SIGKILL	10) SIGUSR1
11) SIGSEGV	12) SIGUSR2	13) SIGPIPE	14) SIGALRM	15) SIGTERM
16) SIGSTKFLT	17) SIGCHLD	18) SIGCONT	19) SIGSTOP	20) SIGTSTP
21) SIGTTIN	22) SIGTTOU	23) SIGURG	24) SIGXCPU	25) SIGXFSZ
26) SIGVTALRM	27) SIGPROF	28) SIGWINCH	29) SIGIO	30) SIGPWR
31) SIGSYS	34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3
38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8
43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13
48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12
53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7
58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2
63) SIGRTMAX-1	64) SIGRTMAX
</code></pre>
<p>Notice! Not all signals can be catched in application, some of them reserved by OS. For example, if you will try to handle <strong>kill -SIGKILL (kill -9)</strong> , then you get:</p>
<pre><code class="language-java">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Signal already used by VM or OS: SIGKILL
	at java.base/jdk.internal.misc.Signal.handle(Signal.java:173)
	at jdk.unsupported/sun.misc.Signal.handle(Signal.java:157)
</code></pre>
</p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/08/wildfly-load-balancing-metrics.html"><h1>Wildfly. Configure load balancing metrics</h1></a>
				<p>06 August 2019</p>
  			<p><p>Previously i wrote about <a href="https://kostenko.org/blog/2019/04/wildfly-cluster-domain-mode.html">Wildfly domain mode cluster and load balancing from the box</a>. But what if we would like to do balancing depends on specific server behavior ?</p>
<p>Wildfly subsystem <code>mod_cluster</code> provide us several predefined metric types to determine best request balancing:</p>
<ul>
<li><strong>cpu</strong>: based on CPU load</li>
<li><strong>mem</strong>: based on system memory usage</li>
<li><strong>heap</strong>: based on heap usage</li>
<li><strong>sessions</strong>: based on number of web sessions</li>
<li><strong>requests</strong>: based on amount of requests/sec</li>
<li><strong>send-traffic</strong>: based on outgoing requests traffic</li>
<li><strong>receive-traffic</strong>: based on incoming requests POST traffic</li>
<li><strong>busyness</strong>: computes based on amount of Thread from Thread Pool usage that are busy servicing requests</li>
<li><strong>connection-pool</strong>: based on JCA connections</li>
</ul>
<p>As well you also can configure <strong>weight</strong> (impact of a metric respect to other metrics) and <strong>capacity</strong> properties;<br />
Below is example, how to change default based on CPU balancing to balancing based on busyness + CPU:</p>
<pre><code class="language-java">/subsystem=modcluster/mod-cluster-config=configuration/dynamic-load-provider=configuration/load-metric=cpu:remove()
/subsystem=modcluster/mod-cluster-config=configuration:add-metric(type=busyness,weight=2)
/subsystem=modcluster/mod-cluster-config=configuration:add-metric(type=cpu,weight=1)
</code></pre>
<p>If predefined types is not enough, - you can provide <code>custom-load-metric</code> by implementing <code>org.jboss.modcluster.load.metric.impl.AbstractLoadMetric</code>. To possibility of using your custom metric,- you need to copy packaged JAR to <code>modcluster</code> module and update <code>module.xml</code>. Now you can use your custom metric with your configuration like</p>
<pre><code class="language-java"> &lt;custom-load-metric class=&quot;org.kostenko.examples.wldfly.modcluster.MyBalancingMetric&quot;&gt;  
</code></pre>
</p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/08/embedded-jetty-server-cut-responses.html"><h1>Embedded Jetty server truncates responses</h1></a>
				<p>06 August 2019</p>
  			<p><p>Jetty server has lot of configuration options. One of them is <code>OutputBufferSize</code></p>
<pre><code class="language-java">HttpConfiguration httpConfig = new HttpConfiguration();
httpConfig.setOutputBufferSize(1024);
</code></pre>
<p>If this property set to value less than your respopnse - jetty just will truncate last one.</p>
</p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/08/WFLYEJB0054.html"><h1>WFLYEJB0054: Failed to marshal EJB parameters</h1></a>
				<p>05 August 2019</p>
  			<p><p>Usually error <code>WFLYEJB0054: Failed to marshal EJB parameters</code> can be throw by next reason:</p>
<ul>
<li>Your data transfer object does not implement Serializable</li>
<li>Your transfered object does not exist in destination module classpath (for example, if you are using DTO without strong typing)</li>
</ul>
<p>Also, you can catch this error with absolutely unexpected scenario and unclear stacktrace when your EJB throws some unchecked exception with stacktrace that has objects from points above.</p>
</p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/07/sql-trick-insert-if-noe-exists.html"><h1>SQL trick. Insert if not exists</h1></a>
				<p>24 July 2019</p>
  			<p><p>Next SQL trick allows you perform conditional <code>INSERT</code> with your query.</p>
<p>For example, lets do insert if record not exists yet:</p>
<p>SQL:</p>
<pre><code class="language-sql">INSERT INTO my_table (id, name)  
    SELECT 1, 'name' FROM dual  WHERE NOT EXISTS (SELECT 1 FROM my_table WHERE ID = 1);
</code></pre>
</p>
				<hr/>

		<ul class="pager">
				<li class="previous"><a href="https://kostenko.org/">Previous</a></li>
			<li">Page: 2/6 (<a href="../archive.html">archive</a>)</li>
				<li class="next"><a href="https://kostenko.org/3">Next</a></li>
		</ul>
		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2019 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.6.3</a></p>
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery-1.11.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <!--script src="../js/prettify.js"></script-->
		<script src="../js/prism.js"></script>
  </body>
</html>
