<!DOCTYPE html>
<html lang="en">
  <head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132824591-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-132824591-1');
</script>

    <meta charset="utf-8"/>
    <title>Sergii Kostenko's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/asciidoctor.css" rel="stylesheet">
    <link href="css/base.css" rel="stylesheet">
    <!--link href="css/prettify.css" rel="stylesheet"-->
    <link href="css/prism.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">
	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <b><a class="navbar-brand" href="index.html">Sergii Kostenko's Blog</a></b>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="about.html">About</a></li>
						<li><a href="resume.html">Resume</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tags <b class="caret"></b></a>
              <ul class="dropdown-menu">
										<li><a href="tags/SQL.html">SQL</a></li>
										<li><a href="tags/JPA.html">JPA</a></li>
										<li><a href="tags/CDI.html">CDI</a></li>
										<li><a href="tags/GitHub.html">GitHub</a></li>
										<li><a href="tags/Linux.html">Linux</a></li>
										<li><a href="tags/Hibernate.html">Hibernate</a></li>
										<li><a href="tags/Wildfly.html">Wildfly</a></li>
										<li><a href="tags/JBake.html">JBake</a></li>
										<li><a href="tags/Java EE.html">Java EE</a></li>
								</ul>
						</li>
          </ul>
					<!-- switch language -->
					<ul class="nav navbar-nav navbar-right">
						<li><a href="/">en</a></li>
						<li><a href="/ru">ru</a></li>
						<li><a  class="icon-rss" href="feed.xml"></a></li>
					</ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">


				<a href="https://kostenko.org/blog/2019/04/jbake-blog-pagination.html"><h1>JBake blog pagination</h1></a>
				<p>10 April 2019</p>
  			<p><p>To enable pagintation support on your JBake based blog you need to provide next properties in your <code>jbake.properties</code> file:</p>
<pre><code class="language-java">index.paginate=true
index.posts_per_page=5
</code></pre>
<p>After that JBake will generate subdirectories <code>2,3,4...</code> for your <code>index.html</code>. Next, you need to update <code>index</code> template to generate necessary count of posts per each index page and provide &quot;previous&quot;,&quot;next&quot; navigation buttons.</p>
<p>Below, I will show you freemarker template with pagination support, that I am using for this blog</p>
<pre><code class="language-java">&lt;#include &quot;header.ftl&quot;&gt;
	&lt;#include &quot;menu.ftl&quot;&gt;
	&lt;#list posts as post&gt;
  		&lt;#if (post.status == &quot;published&quot;  &amp;&amp; post?index &gt;= (currentPageNumber-1) * config.index_posts_per_page?eval &amp;&amp; post?index &lt; currentPageNumber * config.index_posts_per_page?eval)&gt;
				&lt;a href=&quot;${post.uri}&quot;&gt;&lt;h1&gt;&lt;#escape x as x?xml&gt;${post.title}&lt;/#escape&gt;&lt;/h1&gt;&lt;/a&gt;
				&lt;p&gt;${post.date?string(&quot;dd MMMM yyyy&quot;)}&lt;/p&gt;
  			&lt;p&gt;${post.body}&lt;/p&gt;
				&lt;hr/&gt;
  		&lt;/#if&gt;
  	&lt;/#list&gt;
		&lt;ul class=&quot;pager&quot;&gt;
			&lt;#if (currentPageNumber &gt; 1)&gt;&lt;li class=&quot;previous&quot;&gt;&lt;a href=&quot;${config.site_host}/${(currentPageNumber==2)?then('', currentPageNumber-1)}&quot;&gt;Previous&lt;/a&gt;&lt;/li&gt;&lt;/#if&gt;
			&lt;li&gt;Page: ${currentPageNumber}/${numberOfPages} (&lt;a href=&quot;${content.rootpath}${config.archive_file}&quot;&gt;archive&lt;/a&gt;)&lt;/li&gt;
			&lt;#if (currentPageNumber &lt; numberOfPages)&gt;&lt;li class=&quot;next&quot;&gt;&lt;a href=&quot;${config.site_host}/${currentPageNumber + 1}&quot;&gt;Next&lt;/a&gt;&lt;/li&gt;&lt;/#if&gt;
		&lt;/ul&gt;
&lt;#include &quot;footer.ftl&quot;&gt;
</code></pre>
<p>Blog sources available on <a href="https://github.com/kostenkoserg/kostenko.blog.src">GitHub</a></p>
</p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/04/java-ee-cdi-events.html"><h1>Java EE CDI events. Dynamic qualifier.</h1></a>
				<p>08 April 2019</p>
  			<p><p>Java EE provides us really nice mechanism for event processing. Which is part of the CDI for Java specification. Dynamic qualifier for CDI Events can be very useful, for example, in domain driven design, web socket messages routing or any other stuff depends on needs.</p>
<p>Firing simple event looks like:</p>
<pre><code class="language-java">@Named
public class MyEventSource {

    @Inject
    private Event&lt;String&gt; myEvent;

    public void fireEvent(){
        myEvent.fire(&quot;Hello World!&quot;);
    }
}
</code></pre>
<p>then event observer like:</p>
<pre><code class="language-java">@Named
public class MyEventObserver {
    public void observeEvent(@Observes String message){
        System.out.println(message);
    }
}
</code></pre>
<p>With CDI Qualifier (fancy annotation) you can specify which observer should serve the event</p>
<pre><code class="language-java">@Qualifier
@Retention(RUNTIME)
@Target({METHOD, FIELD, PARAMETER, TYPE})
public @interface Important {
}
</code></pre>
<p>For  example:</p>
<pre><code class="language-java">@Named
public class MyEventSource {

    @Inject
    @Important
    private Event&lt;String&gt; myEvent;
    ...
</code></pre>
<pre><code class="language-java">@Named
public class MyEventObserver {
  public void observeEvent(@Observes @Important String message){
    ...
</code></pre>
<p>By default event will be fired in current transaction, but you can change this behavior with <code>@Observes</code> attribute  <code>during</code></p>
<pre><code class="language-java">@Named
public class TransactionEventObserver {
    public void observeImportantMessage(@Observes(during = TransactionPhase.AFTER_SUCCESS) String message){
        System.out.println(message);
    }
}
</code></pre>
<p>Available next values:</p>
<ul>
<li>IN_PROGRESS</li>
<li>BEFORE_COMPLETION</li>
<li>AFTER_COMPLETION</li>
<li>AFTER_FAILURE</li>
<li>AFTER_SUCCESS</li>
</ul>
<p>Now, let's take a look on dynamically qualification of CDI event. In the example below we will create observer to serve user events like login, logout, registration etc from the abstract event source. As was noticed earlier, event can be fired from different sources depends on your needs.</p>
<p>So, first we need to create <code>Qualifier</code> with available events values</p>
<pre><code class="language-java">@Qualifier
@Target({METHOD, FIELD, PARAMETER, TYPE})
@Retention(RUNTIME)
public @interface UserEvent {

    Routes value();
}
</code></pre>
<p>where Routes is enum with available values, for example:</p>
<pre><code class="language-java">public enum Routes {
  LOGIN,
  LOGOUT,
  REGISTRATION
}
</code></pre>
<p>Then we need to create child class of <code>javax.enterprise.util.AnnotationLiteral</code> to possibility of inline instantiation of annotation type instance.</p>
<pre><code class="language-java">public class UserEventBinding extends AnnotationLiteral&lt;UserEvent&gt; implements UserEvent {

    Routes routes;

    public UserEventBinding(Routes routes) {
        this.routes = routes;
    }

    @Override
    public Routes value() {
        return routes;
    }
}
</code></pre>
<p>Now, let's fire event with dynamically observer selection</p>
<pre><code class="language-java">@Named
public class UserEventSource {

    @Inject
    private Event&lt;String&gt; userEvent;

    public void fireEvent(Routes route){
        userEvent.select(new UserEventBinding(route)).fire(&quot;Instead of string you can use your object&quot;);
    }
}
</code></pre>
<p>So, time to show how our Observer looks like</p>
<pre><code class="language-java">import static Routes.*;
...

@Named
public class UserObserver {

    public void registration(@Observes @UserEvent(REGISTRATION) String eventData) {
      ....
    }

    public void login(@Observes @UserEvent(LOGIN) String eventData) {
      ....
    }

    public void logout(@Observes @UserEvent(LOGIN) String eventData) {
      ....
    }
}
</code></pre>
<p>P.S. From Java EE 8 with CDI 2.0 you can use <strong>asynchronous CDI Events</strong> whith <code>fireAsync</code> method and  <code>@ObservesAsync</code> annotation...</p>
</p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/03/wildfly-large-request.html"><h1>Wildfly large request processing</h1></a>
				<p>26 March 2019</p>
  			<p><p>By default Undertow subsystem on Wildfly AS configured to process requests with <code>max-post-size</code>= 10MB. So, in case your request larger than 10MB you will get</p>
<pre><code class="language-java">java.io.IOException: UT000020: Connection terminated as request was larger than 10485760
</code></pre>
<p>To increase this parameter you can edit directly <code>standalone</code> or <code>domain</code> configuration, like</p>
<pre><code class="language-xml">&lt;subsystem xmlns=&quot;urn:jboss:domain:undertow:3.1&quot;&gt;
  &lt;buffer-cache name=&quot;default&quot;/&gt;
  &lt;server name=&quot;default-server&quot;&gt;
    &lt;http-listener name=&quot;default&quot; socket-binding=&quot;http&quot; max-post-size=&quot;15728640&quot; redirect-socket=&quot;https&quot; enable-http2=&quot;true&quot;/&gt;
    &lt;https-listener name=&quot;https&quot; socket-binding=&quot;https&quot; max-post-size=&quot;15728640&quot; security-realm=&quot;SSLRealm&quot;/&gt;
....
</code></pre>
<p>or use CLI commands as shown below:</p>
<pre><code class="language-bash">/subsystem=undertow/server=default-server/http-listener=default/:write-attribute(name=max-post-size,value=15728640)
/subsystem=undertow/server=default-server/https-listener=https/:write-attribute(name=max-post-size,value=15728640)
</code></pre>
<p>Notice! If you are using Wildfly in domain mode with AJP load balancer, you also may need to change  <code>max-post-size</code> for <code>ajp-listener</code></p>
<pre><code class="language-bash">/subsystem=undertow/server=default-server/ajp-listener=ajp/:write-attribute(name=max-post-size,value=15728640)
</code></pre>
</p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/03/hibernate-search-intro-video.html"><h1>My Hibernate Search introduction video</h1></a>
				<p>20 March 2019</p>
  			<p>
Have published my second YouTube video (about Hibernate Search and integration with Wildfly)!

<br/><br/>
<div class="row">
    <iframe align ="center" class="col-md-offset-3 col-lg-6 col-md-6 col-sm-12 col-xs-12" height="315" src="https://www.youtube.com/embed/RuGyErfhmL0" frameborder="0" allowfullscreen="true"></iframe>
</div>
</p>
				<hr/>
				<a href="https://kostenko.org/blog/2019/03/sql-trick-conditional-count.html"><h1>SQL trick. Conditional count for select clause</h1></a>
				<p>16 March 2019</p>
  			<p><p>To perform conditional logic in your SQL <code>SELECT</code> clause you can use <code>CASE</code> expression. Next SQL trick allows you perform conditional <code>count()</code> with your query.</p>
<p>For example, to  select count of records with <code>id &gt; 5</code>:</p>
<p>SQL:</p>
<pre><code class="language-sql">SELECT SUM(CASE WHEN id &gt; 5 THEN 1 ELSE 0 END) FROM Table
</code></pre>
<p>JPQL:</p>
<pre><code class="language-java">entityManager.createQuery(&quot;SELECT SUM(CASE WHEN b.id &gt; 5 THEN 1 ELSE 0 END) FROM BlogEntity b&quot;).getSingleResult()
</code></pre>
<p>Criteria API:</p>
<pre><code class="language-java">CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery&lt;Number&gt; query = cb.createQuery(Number.class);
Root&lt;BlogEntity&gt; blogEntity = query.from(BlogEntity.class);

query.select(
        cb.sum(
                cb.&lt;Number&gt;selectCase()
                        .when(cb.gt(blogEntity.get(&quot;id&quot;), 5), 1)
                        .otherwise(0)
        )
);

Number result = em.createQuery(query).getSingleResult();
</code></pre>
<p>Test cases source code available on  <a href="https://github.com/kostenkoserg/jpa-examples/blob/master/src/test/java/org/kostenko/example/jpa/JpaConditionalCountTest.java">GitHub</a></p>
</p>
				<hr/>

		<ul class="pager">
			<li">Page: 1/3 (<a href="archive.html">archive</a>)</li>
				<li class="next"><a href="https://kostenko.org/2">Next</a></li>
		</ul>
		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2019 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.6.3</a></p>
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!--script src="js/prettify.js"></script-->
		<script src="js/prism.js"></script>
  </body>
</html>
